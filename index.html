<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="A JavaScript Computer Vision Library">
        <meta name="author" content="Eugene Zatepyakin">
        <title>JSFeat - JavaScript Computer Vision Library.</title>
		<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
		<script src="js/jquery-1.9.1.min.js"></script>
        <script type="text/javascript" src="js/jsfeat/jsfeat-min.js"></script>
        <script type="text/javascript" src="js/jsfeat/compatibility.js"></script>
        <script type="text/javascript" src="js/jsfeat/profiler.js"></script>
        <script type="text/javascript" src="js/jsfeat/dat.gui.min.js"></script>
        <script type="text/javascript">
		document.addEventListener("deviceready", onDeviceReady, false); 
		function onDeviceReady() {
        //$(window).load(function() {
            "use strict";

            var stat = new profiler();

            var gui,options,ctx,canvasWidth,canvasHeight;
            var img_u8, corners;
			var lap_thres = 50;
			var eigen_thres = 80;
			
			var canvas = document.getElementById('canvas');
			ctx = canvas.getContext('2d');

			var img = new Image();
			img.onload = function() {
				ctx.drawImage(img, 0, 0, 640, 480);
								
				canvasWidth  = canvas.width;
				canvasHeight = canvas.height;
				
				ctx.fillStyle = "rgb(0,255,0)";
				ctx.strokeStyle = "rgb(0,255,0)";
	
				img_u8 = new jsfeat.matrix_t(640, 480, jsfeat.U8_t | jsfeat.C1_t);
	
				corners = [];
				var i = 640*480;
				while(--i >= 0) {
					corners[i] = new jsfeat.keypoint_t(0,0,0,0);
				}
	
				stat.add("grayscale");
				stat.add("box blur");
				stat.add("yape06");
				//}
				
				var imageData = ctx.getImageData(0, 0, 640, 480);
				
				stat.start("grayscale");
				jsfeat.imgproc.grayscale(imageData.data, 640, 480, img_u8);
				stat.stop("grayscale");
	
				stat.start("box blur");
				jsfeat.imgproc.box_blur_gray(img_u8, img_u8, 2, 0);
				stat.stop("box blur");
	
				jsfeat.yape06.laplacian_threshold = lap_thres;
				jsfeat.yape06.min_eigen_value_threshold = eigen_thres;
	
				stat.start("yape06");
				var count = jsfeat.yape06.detect(img_u8, corners);
				stat.stop("yape06");
	
				// render result back to canvas
				var data_u32 = new Uint32Array(imageData.data.buffer);
				render_corners(corners, count, data_u32, 640);
						
				ctx.putImageData(imageData, 0, 0);
	
				$('#log').html(stat.log());
				$('#log').append(' - Harllei');
	
				function render_corners(corners, count, img, step) {
					var pix = (0xff << 24) | (0x00 << 16) | (0xff << 8) | 0x00;
					for(var i=0; i < count; ++i)
					{
						var x = corners[i].x;
						var y = corners[i].y;
						var off = (x + y * step);
						img[off] = pix;
						img[off-1] = pix;
						img[off+1] = pix;
						img[off-step] = pix;
						img[off+step] = pix;
					}
				}
			
			
			}
			img.src = 'img/samsung3.jpg';
        //});
		}
        </script>
    </head>
    <body>
            <div style=" width:640px;height:480px;margin: 10px auto;">
                <canvas id="canvas" width="640" height="480"></canvas>
                <div id="no_rtc" class="alert alert-error" style="display:none;"></div>
                <div id="log" class="alert alert-info"></div>
            </div>
	</body>
</html>